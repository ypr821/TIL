# 자동 로그인 기능 보안 이슈 고민

작성일자 : 2022-01-12



### 이슈 내용 

- 자동 로그인 기능은 쿠키 value 사용해서 인증을 한다.
- 보안에 취약한 쿠키 자체에 대한 안전성 문제가 있다.
- 쿠키 value 값으로 user 테이블의 기본키인 userSeq를 사용하고 있다. 기본적인 쿠키 보안 설정을 해도 악의적인 사용자가 쿠키값에 일정 숫자를 다르게 입력하면 다른 사용자의 권한으로 로그인할 수 있는 문제가 있다.



### 해결방법 

- Http에서 제공하는 setHttpOnly, setSecure 설정을 true로 한다.

  - setHttpOnly : XSS(Cross Site Scripting) 공격 차단, 자바스크립트로 쿠키 조회를 막는다.

  - setSecure   : Https 로 통신하는 경우에만 웹브라우저가 쿠키를 서버로 전송하는 옵션이다. Https는 HTTP protocol의 암호화된 버전이다.

- 쿠키 value에 암호화를 적용하여 저장하고 클라이언트에게 전달할 수 있도록 해야한다.

- 기존 회원의 비밀번호는 **Bcrypt**으로 암호화하여 저장하고 있다. 문제는 기존 **Bcrypt**으는 단방향 방식으로 암호화만 가능하며 복호화는 불가능하기 때문에 쿠키 value를 복호화하여 로그인 처리를 할 수 없다.

- 고급 암호 표준 알고리즘인 **AES256**은 양방향 방식으로 서버에 키만 가지고 있으면 암호화/복호화를 할 수 있다. 이러한 이유로 쿠키 value를 암호화할 때는 **Bcrypt** 대신 **AES256**를 적용하기로 하였다.

- AES256의 단점은 **AES256**은 키가 유출되면 보안의 의미가 사라지기 때문에 키에 대한 정보 저장에 안정성 확보가 필요하다.

